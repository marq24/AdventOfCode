package de.emac.aoc;

import java.util.HashMap;
import java.util.HashSet;

public class D17 {

    public static void main(String[] args) {
        Util.tStart(0);
        //System.out.println("res1: " + v1(INTEST, 2022) +" (3068)");
        // i:50 [curRockIdx: 0, curJetIdx: 2] previous DELTAs: iter: 35 yMax: 53
        //System.out.println("res2: " + v2(INTEST, 1000000000000l, 50, 35, 53) +" (1514285714288)");

        System.out.println("res1: " + v1(INPUT, 2022) +" (3219)");
        // i:1950 [curRockIdx: 0, curJetIdx: 1169] previous DELTAs: iter: 1740 yMax: 2754
        System.out.println("res2: " + v2(INPUT, 1000000000000l, 1950, 1740, 2754) +" (1582758620701)");

        Util.tEnd(0);
    }

    private static long v2(char[] jets, long loop, int iWhenCycleStarted, int stepsPerCycle, int rowsAddedPerCycle) {
        int cycleStart = iWhenCycleStarted - stepsPerCycle;
        long cyclesToSkip = (loop - cycleStart) / stepsPerCycle;

        long rowsThatCanBeCalculatedBySimplyMath = cyclesToSkip * rowsAddedPerCycle;
        long iterationsThatCanBeSkipped = cyclesToSkip * stepsPerCycle;

        int dyLeft = v1(jets, loop - iterationsThatCanBeSkipped);
        return rowsThatCanBeCalculatedBySimplyMath + dyLeft;
    }

    public static int v1(char[] jets, long loop) {
        HashSet<Pos> map = new HashSet<>();

        int curRockIdx = 0;
        int curJetIdx = 0;
        int yMax = 0;
        //HashMap<Pos, int[]> starts = new HashMap<>();
        for(int i=0; i<loop; i++){
            /*Pos idx1 = new Pos(curRockIdx, curJetIdx);
            if (starts.containsKey(idx1)) {
                int[] data = starts.get(idx1);
                int iPrev = data[0];
                int yMaxPrev = data[1];
                System.out.println("i:" + i + " [curRockIdx: " + curRockIdx + ", curJetIdx: " + curJetIdx + "] previous DELTAs: iter: " + (i - iPrev) + " yMax: " + (yMax - yMaxPrev));
            }
            starts.put(idx1, new int[]{i, yMax});*/

            int y = yMax + 3;
            int x = 2;
            Pos[] rock = rocks[curRockIdx];
            curRockIdx = (curRockIdx + 1) % rocks.length;

            boolean fall = true;
            while(fall){
                int newX = jets[curJetIdx] == '>' ? x + 1 : x -1;
                curJetIdx = (curJetIdx + 1) % jets.length;

                // check if we can move x-axis wise to the new x-POS?!
                if(!collide(map, rock, new Pos(newX, y))){
                    x = newX;
                }

                // check if we have hit the other parts (or the ground)
                if(collide(map, rock, new Pos(x, y - 1))){
                    fall = false;
                } else {
                    y -= 1;
                }
            }

            // marking the final position of the part in the map...
            for(Pos rPos : rock){
                yMax = Math.max(yMax, y + rPos.y + 1);
                map.add(new Pos(x + rPos.x, y + rPos.y));
            }
        }
        return yMax;
    }

    private static boolean collide(HashSet<Pos> map, Pos[] rock, Pos pos) {
        for(Pos aPos: rock){
            int x = pos.x + aPos.x;
            int y = pos.y + aPos.y;
            if(x < 0 || x >= 7){
                return true;
            }
            if(y < 0){
                return true;
            }
            if(map.contains(new Pos(x,y))){
                return true;
            }
        }
        return false;
    }

    public record Pos(int x, int y){};

    static Pos[][] rocks = new Pos[][]{
            {new Pos(0,0),new Pos(1,0),new Pos(2,0),new Pos(3,0)},
            {new Pos(0,1),new Pos(1,0),new Pos(1,1),new Pos(1,2),new Pos(2,1)},
            {new Pos(0,0),new Pos(1,0),new Pos(2,0),new Pos(2,1),new Pos(2,2)},
            {new Pos(0,0),new Pos(0,1),new Pos(0,2),new Pos(0,3)},
            {new Pos(0,0),new Pos(0,1),new Pos(1,0),new Pos(1,1)}
    };

    private static char[] INTEST = ">>><<><>><<<>><>>><<<>>><<<><<<>><>><<>>".toCharArray();
    private static char[] INPUT = ">><<<>>>><<>>><<>><>>>><<<><<><>>><<<><<<>>><<>>><<<>>><>>>><<<>>>><<<><<>>><>>>><<>>>><<>>><><>>>><<<>><<<>>>><<>>>><<<>>><<>>><>>><<<>><<<<>><<<<>>>><<<<>>>><<><<<>>>><<><>>>><<><>>><<<><<><>>>><<<>>><>>>><<<>>><<>>>><<<><<<>>><><>><>>>><<>>><<<><>>>><<>><<<>>>><<>><>>><<>><<>>>><<>><<<>><<>>><<>>>><><<>><<<<><<>>><<<<>><>><>>>><<><<<>><<<<>>><>>><<<<>>><><<<>>><<>><>>>><<>>>><<<>>>><<>><<>>>><<<>><<>><<<><<<<>>>><<<><<<><>>><><<<<>>>><><<<<><<<<>><>>><<>><<<<><<<<><<><<<<>><<<<>><<>><<<>><<<>><>><<<>>><<>><<<<>>>><<<<>>><<>>>><<<>><>>>><<<<>>>><<<<>>>><<>><>><<>><<<<>>><<<>>><<<<>>><<<>>>><<>>>><<>>><>><<>><<<><><><<<<>><><<<<>><<>><<>>><<<<>>>><>>><<>>>><<<>>><<<>>><<<><><>>><<<<>>><>>><<<>>><><<>>>><<<<>>>><<<<><>>><<>>>><<<<>><<<>>><><<<<>>><<<>><<>>>><<>>><<<>>><<<>>><<>>><<>>>><<<<>><<><>>><<<<>>><<<>>><>>>><<<>>><<<>>><<<<>>>><<<<>><<<>>>><<<><<<<><<>><<<>>><<<>>>><<<>><<<<>>><<<<><>>>><<<>>><><<<>>>><<><<<><<<<>>>><<>><>>>><<<>>><<<>>><<>>>><>>><><<<<>>>><<<>>><<<<>><>>>><>><>>>><>>>><<<<>>>><<>>><<>><<>><<<><>><<<>>><<>>>><<<>><<><<<<>>>><<<<><><<>>><>><><<>>><<>>>><<><<<>><<<>>><>>>><<<><<>>>><<>>>><<>>><<<>>>><>>><<<<>><<<<><<<<><<<<>><<<<><<<>>>><>><<<>><<><<>><<<>><>><<<<>>><>><<<<>><<<<>>>><<<>><<<<>>>><<<>><<>>>><<<<>>><>>>><<>>>><<<<>>><<>>>><>>><<<<>>>><<<>>><<<><<<>><><>><<<<>>>><<<<>><<<><<<>>>><<>>><<><<>>><<>><<<>>><<<>>><<<>>>><>>>><<<<>>>><<<>><<<<><<<>><<>>><>>><<<<>>><<<>><>>><<<><<<<><<>><<<<><>><<<>><<><<<>>><<<<>>><<<>>><<><>><<<<><><<<<>>>><<>>><<<<>>><>><<<<><<>><<<<>>><<>>><<<<>><<>>><<<<>><>>>><<>><<<<>>>><<>>>><<<<>><<<>><<>>>><<<>>>><>>>><>>>><<<><<>>><<>>><<<<>>><>><><<<<>>>><<<><<<>>><>>><<>><<>>><<>>><<<>>><<<<>><<>>>><<<><<>>>><>><<<>>>><>>>><<<>>><<><<<<>><<<>>><<>>><<<<>>><<<<><<<<>>><<<>>><>>><<>><<<<>>><>><<><<<<>>><<>>><>>><<>>><><<>>>><<<<>>><>>><>>><>><>>><<<<>><<<><<>><<<<>>><>>>><<<<>><<<<><<<<>>>><<>>><<<>>>><<<>><>>><<<<>>><<>>>><<>>><<>>>><>>>><<><<<>>><<<>><<>><<<<>><>>>><<>>>><<><<<>>><>>>><<<<><<<>><>>><<<<>><>><<>>>><<<>><<<>><>>>><><>>>><>>><<<<>>>><<<>>>><<<>>><><<<<><>>><<<<>>>><<<><<><<<><<>>>><><>>>><<<<>><<<<>>><><><<<>><<>>>><<<><<<<>>><<<<><<<<>>><<<>>><<><<>>><<<>>><<<>>><<>>><<>><>><<<<>>><<<>>><<<>>><>>><<>><<>>><<<<>>>><<><<>>>><<><<<<>>><<<><<<>>><><<<>>><<>>><<<>>>><<<<>>>><><<>>><<<>>>><<<>>>><<><<>>>><<<>><<>><<>>>><<>><<<><><<<><>>><><>>><<>>>><<<>><>>><>><>>>><<<<>>><>>><>><<<><<>>>><<<>>>><<><><<<>><<>><<<><<<><<><<<<>>><>><<<<>>><<<>>><<>>><<>>><<><<<<>>>><<>>><>><<<<>><<>>><>><<>><<<><>>><<><<<>>>><<<><>>>><<<<>><<<<><>><>><><<<>><<<>>>><><<<><<>><<>><>>><<<>>>><<>><<<<>>>><>>>><<>><<<>><<<>><<<<><<<<>>><<>>>><<<<>><<>>>><<<<>>><<<>><<>><<>><<<<><>>>><<<<><<<<>>><<<>><<>><<<>><><><<<<><<>><<><<<<>>><<>><<<>>><<<<><<>><>><<<><>>><>>><>><<>>>><<<<>>>><<<<><<<>>>><<<>><>>>><>>>><>>><<>>>><<<<>><<<>>><<<<>>><<>>><>>>><<<<>>><<<<>>>><<><<>><>>>><<><>>>><>>><<<><<>>><<<<>>>><>><<<<><<<<><>>><><<<<>>><>>><<<>>>><<>>>><<><<<>>><<<>><<>>><>><>>><<>>><<<<>>>><<<>><><<<<>>><<<<>><<>>>><<>>>><>>><<<>>>><<<>>>><<>>><<>><<<>>>><<<<>><<>>>><<<>>>><>>><<>>><<>><<<>>>><<>><><>><<<><<<>>><>>>><<><><<<<>><>>><<<<>><<<><>>>><>>>><<><<<<>>>><>>>><>><<<<>>>><<>><<<<><<<><<<<><<>><>><>>><>><<>><<<>><<<<><<<>>>><<<<>><<><<<<>>>><<<>>><<>>>><<>><<<<><<<<>>>><<<>><<<>>>><<>>><>>>><<><<>>>><<<><>>><>>><<<>>><<<><<>>><<>>><><>>>><<<>>><<<>>>><<<<>><><<<>>><<>><<<<>>>><<>>><<<<><>><<<<>>>><<<<>>>><><>>>><>><>>><<<<><><<<>>>><<<<>><>>><<<<>>>><<>>>><<<<>><>>><<>><<>><>>>><<<><<<<>>><<<><<>>>><<>><<<>><<<<>><<<>>>><>>>><<>>><<<>><<>><<<>>>><<<>><>>>><>><<<>>>><>><<>>>><>>>><<<>>>><<<<>>>><<<><>><<<<>>>><>>>><<>><<<>><<><<<<>>>><<<<>>><<>>><<<<>><<<>><<<><<<><<<<>><<<<>>>><<>>><>>><>>>><<<>>>><<<>>><<<>>>><<>>><<<>>><>><<>>>><<<>>>><<>><<<<><<><<><<>><>>><<<<>>><<<<>>>><<<>>>><<>>><<<>>>><<<>><<>>><>>><<<<><<<<>>>><<<>>>><><<<<>>><>><<><<>><<<>>><<<<><>><<<>><>><<<<>><<<><<><<<<>>>><<>>>><<<<>>><<<<><<><<<><<<<>><<<<>>>><<<<>><<<>>><<><<>><<<>><<<>>><>>>><<>>><<<><<<<><><<<>><<<<>>><<<><>>>><>><>><<<>><>>>><>>>><>>>><<>><<<<><<<>><<<>>><<<<>>><<<>>>><<<>><><<<>><><<<<>><<<<>>><<<><<<>>><<><<>>>><>><<<><<<>><>><<<<><<>>>><>>><<<<>>>><<<>><<>>>><>>><<<<>>><<>>><<<<>><<><<><<<>>>><<<><<<<>><>>>><<<<>><>><<<>><<<>>><<<<>><>>>><<<<>><<>><<<<>>><<<<><<<<>><>><<<>>>><<<>>>><<<>>>><>>>><<<>>>><<>><<><>>><<<<>>><<<<>>>><>><<<<><<<<>>><>><<<<>>>><<<>>>><<>>><>><<><<<><<<><><<<<>>>><<<>>><<<<>>>><<>><<<>>>><<><>>><<<>><>><<<><>><<>><><<<><<><>>>><<<<>>>><>><<>><><<<>><<<>>><<>>>><<<<>><<<<><>>><>>>><<<<>>><<<<>>><<>><<>><>>>><<<>>>><<<>><<><<<<>><>>>><<<<>>>><<><<<><<<<><>><<<>><<<>>><<>><<<<>>><<<<>><<><>>>><<<>>>><<<>>>><>><<<<>>><<>><<<><<>>><<>><<<<>>><<<<>>>><<<>><<<<>><<>>>><<>>>><<<>>>><><<>>>><<<<>><<><>>>><><<<>>>><<>>><<>>><<>><<<><><>>>><><<><<<<>>>><>><<<<>>>><<<>><<<<>>>><><<<>>>><<<>><<<<>>>><>><><<<<>>>><<<>>><<<>><<<<>>>><<<>>><<<>>><<<>>>><<<><<<>>><<<>><<<>>><>>>><<<<>><><<<><<><><<<><<<>><<>><>>><>>>><<><<<><<<<><><<>>><<>>>><<>><>><<>>>><<<>><<>>>><<<><<>><><<<<>><<<<>>>><<>>>><<<>>>><>>>><<><<<>>>><<<>>>><<<<>><<>>>><<<<><<<<>>>><<<<>>>><<<>><<>>><<<>><<<><<>>>><<<<>><<<<><<><>>><<<>><<><>>>><<<<>>>><>>>><<><<<>>><<<<><<>><<<<>>>><<<><>><<>>><>>>><<><<>>><><<<><<<<>>>><><<<<>>><<>><<<>>>><><<<<><<<<>>>><>><<><<<>>><<<><>>><<<>>><<<<>><<<>>><<<>>><<<>>>><<<>>>><<<<><>>>><<>>><><<<<><<<><>><<<><<<><><<<>><<<>>>><<<<>><<>>>><<<<>>><<<>><<<>>><<<<>>><<>>><<>>>><<>>><<<><>>>><<>>>><>>><<>>>><>><<<>><<>>><<>><<<><<<<>><<<>>><<<<>><<<<><><<<<>>>><>>>><><>><<<>>>><<><<<><<><>><<>><<><<<>><>>><<>>>><<>>>><<>>><<<>>><<>>>><<<>><<<<>>><<>><>>><<<<>>>><<>><<<<><<<<><>><>>>><>>><<<<>>>><<<<>>><<<>><><<>>>><<>><>>>><<<><>>>><<>>>><<>>><>>><>>><<><><<<>><<>>><<>>><<>><<<><>>><<<>>>><<>>><>><<>>><><<<>>>><<>>>><>>><<<<>><><<<<><<<<>><<<>>><<>><>>>><<>>><<<>>><<<<>><<<>>>><<<>>>><<<>>>><<><>>><<>>>><<<>>>><<<<><<<<>>>><<>>>><<<>>><<<<>>>><<<<>><<<<>><<<<><><<<>>>><<>><<<>>>><>><>>>><<>>>><<<>><>><<<<><>><<>>><<>>><<<<>>>><<<><><><<>>>><<<<>><<<<>><><<><<<>>><<<>><<<<>><<<><<<>>>><<<><<<>>>><<><<<>><<<<>>><<<>>>><><<<>>><>>>><>>><<>>><>>>><><>>><<<<><><<>><>>>><<<><<<>>>><<<<>>>><<>>><>><<<><<><<<>>><<>><<<>>>><<<<>><<<>>><<<>>>><>><>><>><><<<>><<>>><<<>><>><>>><<<>><><<<>>>><<><><<<<><<>><<<><>><<<<>>>><<<>>><<>>>><<<>>>><<<><<>>>><<<<>>>><<<>><<<<>>>><<><<>>><<>>>><>><>><<<<><>>><>>>><<>><>>>><<>>><<>>><<>>><>><>>>><<<>>>><<>>>><<<>><<>><<>>>><<>>><<<<><<><<<<><<>><<<<>>>><<<>><><><><>>><<<<>><><<<<>>>><>>>><<>>><<<<><<><<>><><<>>>><<<>>><<<<>>>><<<>><<<<>><<<>><>>>><<<><>>>><>>>><<<<>><>>>><<<>>>><>>>><<<<><>><>>>><<<<>>><>><<<>>>><<<><<<><<<<>>><<<>><>><>>>><<<>><<<>>>><<>>>><<>>>><<><<><<>><>><>><<<>>>><<><<<<>>><>>><>><<>><<<>>>><>>>><<<<>><><<>>><<><>>><>>><<>>><<<<><<<>>>><<<<>>>><<<><>>><<>>>><>>>><<<<>><><<><<<<>><<>><>>>><<<<><<<><>><<<<>><<>><<<<>><><<<<>><<<<><<<<><<><<<><>>>><<>>>><<<<>>><>>>><<>><><<>>>><>>>><<<>>><<<>>><<><<>>>><<>>>><<<>><<<><<<<>>><<>>>><<>>>><><<>>><<<><<<><<><<<<>>><<<<>><<<><<<>>>><>><<>><<<><<<>>>><<><<<<>>><<<<>>><<<<>><<<>>><>>><<>>><<<<>><<<<><<<>><<<>><<<<>>><<<<>>>><<><>>><<<<>><<<>><<>>>><><>>><>><<><<<<>><<<<>>><<>>><<<<><<>>>><<<<><><<>><<<>><<>>><<<<><<<><>><>><>>><<<>><><>>>><<<><<<<>>>><>><<<<>><<<<>><><>><>>><<<<>>>><<>><<>>>><<<>>><<<><<<>>><>>>><<<>>><<<>>><<<>>>><<<>>>><>>>><<>><<<<><>><<<>><<<<>>><>>><>><>>><>>>><<<<>>>><>><<<<>>>><>><<>>><<><<><><<<><><<<>><<>>>><<><<<><<<<>>><<<><<<<>><<<<>>><<><<>>><<<><>>><<><<<<>><<<<>>><>>>><<>>><<><><<><>>>><<><<<>>>><<>>><<<<>>>><>>><<<<>>>><<>>>><<>>><<<>><>><<><>><<<<>>>><<<<>>><<><>>><<<<>>><>>><<<>>><<<<>>>><<<>><<>><<><<<<>>><<<><><<<>>><<<>>><<>>>><<>>>><<>>><<<<><<<<><><<>><><<<<>>>><<<>>>><<>><<<<><<<<>><><<<<>>><>><<<<>>>><<<<><>><<<>><<>>><><>>><<>><<<>>><<<<>><<<>>><<>><<>>>><<<<>>>><<>><>><<<>>><<<>>>><<<>>>><<<<>>><<><<><<<<>><<<>>><><<<<>>><>><<>>>><<<<>>>><<<<><<><<>><>>><<><<<>>>><<<><><><<>><>>><<<<><<<<>>><<><<>><>><<<>>>><<<>>>><<><<<>>><>>><<>><<>><<<>>>><<>><<<<>><<<<>><<<<>><<<>>><<><<<<>>><<<<><<<<>>><>>><<<<>><<<<>>>><<>>>><<>>>><><<<><<<<>>><<<>>><<<<>>>><<>>><<>>><<<<>><<<<><<<<><<>>>><<<<>>>><><<<>>><<>><><>>><<<>>><<<><>>><>><<>>>><>>>><>>>><<<<>>><<<>>><>>><>>><<<><>><<<<>>><<>>><>>><<<>>><<>>><>><>><<>><<<>><<<>>>><<<<>><<<><<<>>>><>><>><<<>>>><<<>>><<>>><><<<<><<<<>>>><<<<>>>><><>><>><<<>><<<>><<<<>>>><<>><<<<>>><><<<>><>>>><<>>><<<<>>>><<>><<<<>><>>>><<<<><<<>><<<>>><<<<>><><<<<>>><><<>>>><<<><>>><<<<>>>><<<>><<<<>>>><<<<>>><<>><<<<>><<<<>><<>>>><><<>>>><><<<>>>><<<>>><<<<><<<>><>>><>>><<<>>>><<>>><<<<>><<>>><><<<>><><<<>>>><<<><>><<>>><<<<>><<<>>>><<>>>><<<<>>>><<>><<>>><<<>>><<<>>><>><>>>><<<<>>><<><><<<>>><<<<>>><>>><<<>><<>>>><<<<>><><<<>><<>>><<><>>><<<><<<<>><>><<<>>>><<>>>><>>><>>><<<<>>>><<<<>>><>><><<><<>><>>>><>>><<<<><<>>><<<<>>>><<<>>><<<>><<<<>>>><<>>>><><<><>>><<>>>><<>>><<<>>>><<><<>>>><<<<>>>><>>>><>><<>>><<<>>>><><<>><<><<<<>>><<<>>><<<<>><<>><<<>>>><<<>>>><<<<>>><<<><<<>>><<><<<>>><<<>>>><<<<>><>><<>>><<>>>><<<>>>><<<>>>><>>><<><>>>><>>><<<><<<<><><<<<>>><<<>><<<<>>><><<>><<<<>><>>><>><<<<>>>><><<>><<>>><<<<>><<<><<<>>>><<<>>><<<<><><<<<>>>><>><<><<<<><>><<><<<<>>><<<>>>><<>>>><<<<><<<>>><<<<>>>><<<<><<>>><<<<>>><<<<><<<>><<><<<<><<>>>><><<<<>>>><<<>><>>>><>>><<<<>><><<<<>><<<><<>><<<>>>><<><<><<<><<>>>><<<<>>><<<>>><<<<><<<>>>><<<<>><>><<>>>><>>><<<<><<<<>>>><<<<>>><>>>><<<><<<<>>><>>>><>><<><>><<<<>>><<<>>><<<<><<<<>>><<<><<>>><<<<>>><><<<<><<>><>>><<<<>>><><<<>>>><<<<><<<>><<<<>>><>>>><>><<>><<<<><><>>><<>><>>><<>>>><<<>>><<>>>><<<>><<<<>>><>><<>><<<>>><<<>>>><<<<>>><<<>>><>>>><<>><<<<>>>><<>>>><><>>>><<<><<<>>>><<><>>>><<<<>><>>><<<><><<<<><><<<<>>>><<>><<<>>>><>>>><>>><>>><<<><<<>><>>><>>>><<<<>><<<<><<>>><<<><<<<>><<<<><<<<>><<>><<<><>><<<><><<>><<>>><><<>><>>><>>>><>>>><<<>><<>>><>>><<<<>><<<<>>>><<>>><<<>><<>>><<<><<>><<>>><<><<<<><<<>>><<<<>>><<<<><>>>><>><<<>>>><>>>><<<>>>><<<<>>>><<>>>><>>>><><<>><<<<>>><><<><<<><<<<>>>><<<<>>><<<<>>><>>>><<><<<><<>>><<>>><<<<>>>><><<><>>>><<<<>>>><>>><<<<>>><>><<<<>>><>><<<>>>><<<><>><<<>>><<<>><<<<><<>>><<<>><><<<<>>>><<<>>>><<>>><<>>>><<<<>><<<><<>><<>><><<><><<<<>>>><>>".toCharArray();
}

